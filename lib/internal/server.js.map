{"version":3,"sources":["../../src/internal/server.js"],"names":["StorybookServer","server","url","query","getURL","stringify","kill","optionsToCommandArgs","options","args","port","configDir","host","push","staticDir","startStorybookServer","logger","Promise","resolve","reject","cmd","cwd","storybook","stdout","on","out","str","toString","trim","m","match","s","stderr","log","err"],"mappings":";;;;;;;;AAAA;;AACA;;;;;;;;IAGMA,e;AACJ,2BAAYC,MAAZ,EAAoBC,GAApB,EAAyB;AAAA;;AACvB,SAAKD,MAAL,GAAcA,MAAd;AACA,SAAKC,GAAL,GAAWA,GAAX;AACD;;;;6BAEQ;AACP,aAAO,KAAKA,GAAZ;AACD;;;8BAESC,K,EAAO;AACf,kBAAU,KAAKC,MAAL,EAAV,IAA0BD,cAAY,sBAAGE,SAAH,CAAaF,KAAb,CAAZ,GAAoC,EAA9D;AACD;;;2BAEM;AACL,WAAKF,MAAL,CAAYK,IAAZ;AACD;;;;;;AAIH,IAAMC,uBAAuB,SAAvBA,oBAAuB,CAACC,OAAD,EAAa;AACxC,MAAMC,OAAO,CACX,IADW,EACLD,QAAQE,IADH,EAEX,IAFW,EAELF,QAAQG,SAFH,CAAb;;AAKA,MAAIH,QAAQI,IAAZ,EAAkB;AAChBH,SAAKI,IAAL,CAAU,IAAV,EAAgBL,QAAQI,IAAxB;AACD;;AAED,MAAIJ,QAAQM,SAAZ,EAAuB;AACrBL,SAAKI,IAAL,CAAU,IAAV,EAAgBL,QAAQM,SAAxB;AACD;;AAED,SAAOL,IAAP;AACD,CAfD;;AAiBA,IAAMM,uBAAuB,SAAvBA,oBAAuB,CAACP,OAAD,EAAUQ,MAAV;AAAA,SAAqB,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAAA,QACzEC,GADyE,GAC5DZ,OAD4D,CACzEY,GADyE;AAAA,QACpEC,GADoE,GAC5Db,OAD4D,CACpEa,GADoE;;AAEjF,QAAMZ,OAAOF,qBAAqBC,OAArB,CAAb;AACA,QAAMc,YAAY,0BAAMF,GAAN,EAAWX,IAAX,EAAiB,EAAEY,QAAF,EAAjB,CAAlB;;AAEAC,cAAUC,MAAV,CAAiBC,EAAjB,CAAoB,MAApB,EAA4B,UAACC,GAAD,EAAS;AACnC,UAAMC,MAAMD,IAAIE,QAAJ,GAAeC,IAAf,EAAZ;AACA,UAAMC,IAAIH,IAAII,KAAJ,CAAU,2CAAV,CAAV;;AAEA,UAAID,CAAJ,EAAO;AACL,YAAME,IAAI,IAAI/B,eAAJ,CAAoBsB,SAApB,EAA+BO,EAAE,CAAF,CAA/B,CAAV;AACAX,gBAAQa,CAAR;AACD;AACF,KARD;;AAUAT,cAAUU,MAAV,CAAiBR,EAAjB,CAAoB,MAApB,EAA4B,UAACC,GAAD,EAAS;AACnCT,aAAOiB,GAAP,CAAW,QAAX,EAAqBR,IAAIE,QAAJ,EAArB;AACD,KAFD;;AAIAL,cAAUE,EAAV,CAAa,OAAb,EAAsB,UAACU,GAAD,EAAS;AAC7Bf,aAAOe,IAAIP,QAAJ,EAAP;AACD,KAFD;AAGD,GAtBiD,CAArB;AAAA,CAA7B;;kBAyBeZ,oB","file":"server.js","sourcesContent":["import { spawn } from 'child_process';\nimport qs from 'query-string';\n\n\nclass StorybookServer {\n  constructor(server, url) {\n    this.server = server;\n    this.url = url;\n  }\n\n  getURL() {\n    return this.url;\n  }\n\n  createURL(query) {\n    return `${this.getURL()}${query ? `?${qs.stringify(query)}` : ''}`;\n  }\n\n  kill() {\n    this.server.kill();\n  }\n}\n\n\nconst optionsToCommandArgs = (options) => {\n  const args = [\n    '-p', options.port,\n    '-c', options.configDir,\n  ];\n\n  if (options.host) {\n    args.push('-h', options.host);\n  }\n\n  if (options.staticDir) {\n    args.push('-s', options.staticDir);\n  }\n\n  return args;\n};\n\nconst startStorybookServer = (options, logger) => new Promise((resolve, reject) => {\n  const { cmd, cwd } = options;\n  const args = optionsToCommandArgs(options);\n  const storybook = spawn(cmd, args, { cwd });\n\n  storybook.stdout.on('data', (out) => {\n    const str = out.toString().trim();\n    const m = str.match(/^Storybook started on => (https?:\\/\\/.+)$/);\n\n    if (m) {\n      const s = new StorybookServer(storybook, m[1]);\n      resolve(s);\n    }\n  });\n\n  storybook.stderr.on('data', (out) => {\n    logger.log('STDERR', out.toString());\n  });\n\n  storybook.on('error', (err) => {\n    reject(err.toString());\n  });\n});\n\n\nexport default startStorybookServer;\n"]}